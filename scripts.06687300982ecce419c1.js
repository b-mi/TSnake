document.addEventListener("keydown",keyPush);let canvas=null,score=null,info=null,ctx=null;const tileSize=35;let endEvent,gameSpeed=200,snakeX=0,snakeY=0,snakeSpeed=0,snakeDiffX=0,snakeDiffY=0,clearX=0,clearY=0,foodX=100,foodY=100,tilesCountX=0,tilesCountY=0,scoreNum=0,gameOver=!1,lastKey="R",isPause=!1;const colorSnakeHead="black",colorSnakeBody="gray",colorFood="lime",colorSnakeEyes="goldenrod",colorSnakeCross="orangered",colorBkg="white";let snakeData=[];function init(){canvas=document.querySelector("canvas"),canvas&&(score=document.getElementById("score"),info=document.getElementById("info"),ctx=canvas?.getContext("2d"),snakeY=canvas?.height/2,snakeSpeed=35,snakeDiffX=snakeSpeed,tilesCountX=canvas?.width/35,tilesCountY=canvas?.height/35,snakeData=[])}function startGame(){if(init(),canvas){ctx.fillStyle="lightgray",ctx.fillRect(0,0,canvas.width,canvas.height);for(let e=0;e<canvas.width/35;e++)for(let a=0;a<canvas.width/35;a++)drawRect("white",35*a,35*e,34,34);snakeData.push({x:snakeX,y:snakeY}),clearX=snakeX,clearY=snakeY,drawObject("black",snakeX,snakeY),resetFood(),gameLoop()}}function gameLoop(){if(!1===gameOver){if(0==isPause){switch(snakeX+=snakeDiffX,snakeY+=snakeDiffY,snakeX>=canvas.width&&(snakeX=0),snakeX<=-35&&(snakeX=canvas.width-35),snakeY>=canvas.height&&(snakeY=0),snakeY<=-35&&(snakeY=canvas.height-35),drawObject("black",snakeX,snakeY),lastKey){case"L":drawRect("goldenrod",snakeX+5,snakeY+35-15,10,10),drawRect("goldenrod",snakeX+5,snakeY+5,10,10),drawTongue("orangered");break;case"R":drawRect("goldenrod",snakeX+35-15,snakeY+35-15,10,10),drawRect("goldenrod",snakeX+35-15,snakeY+5,10,10),drawTongue("orangered");break;case"U":drawRect("goldenrod",snakeX+5,snakeY+5,10,10),drawRect("goldenrod",snakeX+35-15,snakeY+5,10,10),drawTongue("orangered");break;case"D":drawRect("goldenrod",snakeX+5,snakeY+35-15,10,10),drawRect("goldenrod",snakeX+35-15,snakeY+35-15,10,10),drawTongue("orangered")}var e;snakeData.some(e=>e.x===snakeX&&e.y===snakeY)&&(info.textContent="YOU LOSE, YOU HAVE EATEN YOUR BODY!",stopGame()),snakeData.splice(0,0,{x:snakeX,y:snakeY}),snakeX===foodX&&snakeY===foodY?snakeData.length>tilesCountX*tilesCountY-1?(score.textContent=++scoreNum,info.textContent="YOU WIN!",stopGame()):(resetFood(),score.textContent=++scoreNum):(drawObject("white",(e=snakeData[snakeData.length-1]).x,e.y),snakeData.splice(-1,1)),snakeData.length>1&&(drawObject("gray",(e=snakeData[1]).x,e.y),ctx.strokeStyle="orangered",ctx.setLineDash([2,2]),ctx.beginPath(),ctx.moveTo(e.x+5,e.y+5),ctx.lineTo(e.x+35-5,e.y+35-5),ctx.moveTo(e.x+35-5,e.y+5),ctx.lineTo(e.x+5,e.y+35-5),ctx.stroke())}setTimeout(gameLoop,gameSpeed)}}function drawTongue(e){ctx.strokeStyle=e,ctx.lineWidth="white"===e?5:1,ctx.fillStyle=e,ctx.setLineDash([]);var a=snakeX,n=snakeY,t=0,s=0,o=0,c=0,r=0,k=0;switch(lastKey){case"L":n+=17.5,o=(t=(a-=3)-6)-5,c=(s=n=Math.round(n))-5,r=t-5,k=s+5;break;case"R":n+=17.5,o=(t=(a+=38)+6)+5,c=(s=n=Math.round(n))+5,r=t+5,k=s-5;break;case"U":a+=17.5,c=(s=(n-=3)-6)-5,o=(t=a=Math.round(a))-5,k=s-5,r=t+5;break;case"D":a+=17.5,c=(s=(n+=38)+6)+5,o=(t=a=Math.round(a))+5,k=s+5,r=t-5}ctx.beginPath(),ctx.moveTo(a,n),ctx.lineTo(t,s),ctx.lineTo(o,c),ctx.moveTo(t,s),ctx.lineTo(r,k),ctx.closePath(),ctx.stroke(),ctx.lineWidth=1}function stopGame(){gameOver=!0,isPause=!1,endEvent.emit({score:scoreNum})}function drawRect(e,a,n,t,s){ctx.fillStyle=e,ctx.fillRect(a,n,t,s)}function drawObject(e,a,n){ctx.fillStyle=e,ctx.fillRect(a,n,34,34)}function keyPush(e){if(!gameOver)switch(e.key){case"ArrowUp":0!==snakeDiffX&&(snakeDiffX=0,snakeDiffY=-snakeSpeed,drawTongue("white"),lastKey="U");break;case"ArrowDown":0!==snakeDiffX&&(snakeDiffX=0,snakeDiffY=snakeSpeed,drawTongue("white"),lastKey="D");break;case"ArrowLeft":0!==snakeDiffY&&(snakeDiffX=-snakeSpeed,snakeDiffY=0,drawTongue("white"),lastKey="L");break;case"ArrowRight":0!==snakeDiffY&&(snakeDiffX=snakeSpeed,snakeDiffY=0,drawTongue("white"),lastKey="R");break;case" ":!1===gameOver&&(isPause=!isPause)}}function resetFood(){for(;foodX=35*Math.floor(Math.random()*tilesCountX),foodY=35*Math.floor(Math.random()*tilesCountY),snakeData.some(e=>e.x===foodX&&e.y===foodY););drawObject("lime",foodX,foodY)}function myTest(e){endEvent=e,startGame()}startGame();